@page "/projects"

@using LightTown.Client.Services.Users
@using LightTown.Client.Web.Services

@inject IUserDataService UserDataService
@inject NavigationManager NavigationManager
@inject AuthenticationService AuthenticationService

<Grid>
    <GridColumn ColumnSize="ColumnSize.Full">
        @if (_projects != null)
        {
            @foreach (var project in _projects)
            {
                <GridItem>
                    <Card>
                        <Grid>
                            <GridColumn ColumnSize="ColumnSize.Medium">
                                <GridItem>
                                    <h4>@project.ProjectName</h4>
                                </GridItem>
                            </GridColumn>
                            <GridColumn ColumnSize="ColumnSize.Small">
                                <GridItem>
                                    <div class="d-inline">
                                        <Tag Text="Tag 1" />
                                        <Tag Text="Tag 2" />
                                        <Tag Text="Tag 3" />
                                    </div>
                                </GridItem>
                            </GridColumn>
                            <GridColumn ColumnSize="ColumnSize.Small">
                                    <Button Enabled="@true" Text="View" OnClick="@(() => ViewProject(project.Id))" Size="ButtonSize.Big"></Button>
                            </GridColumn>
                        </Grid>
                    </Card>
                </GridItem>
            }
        }
    </GridColumn>
</Grid>

@code {

    List<Core.Models.Projects.Project> _projects;

    protected override async Task OnInitializedAsync()
    {
        if (!AuthenticationService.HasAccessToPage(NavigationManager.Uri))
        {
            NavigationManager.NavigateTo("/login");
            return;
        }

        _projects = await UserDataService.GetProjects();
    }

    private Task ViewProject(int projectId)
    {
        NavigationManager.NavigateTo("/projects/" + projectId);

        return Task.CompletedTask;
    }
}
