@page "/login"
@inject NavigationManager NavigationManager
@inject IValidationService ValidationService
@inject IAuthenticationService AuthenticationService
@inject IUserService UserService
@inject Blazored.LocalStorage.ILocalStorageService localStorage;

<Form Id="form-login" Class="mt-2">
    <FormGroup>
        <Input @ref="@LoginUsername" Type="text" Placeholder="Username" OnChange="@ValidateInput" />
    </FormGroup>
    <FormGroup>
        <Input @ref="@LoginPassword" Type="password" Placeholder="Password" OnChange="@ValidateInput" />
    </FormGroup>
    <FormGroup>
        <Button  @ref="@LoginButton" Text="Login" OnClick="@LoginAsync"></Button>
    </FormGroup>
</Form>

@code {

    private Input LoginUsername;
    private Input LoginPassword;

    private Button LoginButton;

    private async Task LoginAsync()
    {

        User result = await AuthenticationService.Login(LoginUsername.Text, LoginPassword.Text);
        if (result.Id != 0)
        {
            await localStorage.SetItemAsync("userId", result.Id);
            result = await UserService.GetUserData(result.Id);
        }
    }

    private Task ValidateInput(string value)
    {
        LoginButton.ToggleEnabled(ValidationService.ValidateLoginInput(LoginUsername.Text, LoginPassword.Text));
        return Task.CompletedTask;
    }
}
