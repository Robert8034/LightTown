@page "/login"
@inject NavigationManager NavigationManager
@inject IValidationService ValidationService
@inject IAuthenticationService AuthenticationService
@inject UserSessionService UserSessionService

<Form Id="form-login" Class="mt-2">
    <FormGroup>
        <Input Type="text" Placeholder="Username" OnChange="@OnUsernameChange" />
    </FormGroup>
    <FormGroup>
        <Input Type="password" Placeholder="Password" OnChange="@OnPasswordChange" />
    </FormGroup>
    <FormGroup>
        <Button @ref="@LoginButton" Text="Login" OnClick="@LoginAsync"></Button>
    </FormGroup>
</Form>

@code {

    private string _username;
    private string _password;

    private Button LoginButton;

    private async Task LoginAsync()
    {

        var result = await AuthenticationService.Login(_username, _password);
        if (result)
        {
            await UserSessionService.LoadUser();

            StateHasChanged();

            NavigationManager.NavigateTo("/");
        }
    }

    private void ValidateInput()
    {
        LoginButton.ToggleEnabled(ValidationService.ValidateLoginInput(_username, _password));

        StateHasChanged();
    }

    public Task OnUsernameChange(string value)
    {
        _username = value;

        ValidateInput();

        return Task.CompletedTask;
    }

    public Task OnPasswordChange(string value)
    {
        _password = value;

        ValidateInput();

        return Task.CompletedTask;
    }
}
